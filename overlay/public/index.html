<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>8bsl Overlay</title>
    <style>
      body { background: transparent; color: white; font-family: sans-serif; }
      .box { padding: 8px 12px; background: rgba(0,0,0,0.6); border-radius: 6px; display:inline-block; text-align:center }
      .label { color: #aaa; font-size: 12px }
      .value { display:flex; align-items:center; justify-content:center; height:56px; width:160px }
      .value-img { max-height:56px; max-width:100%; object-fit:contain; display:block }
      .grid { display:flex; gap:8px; flex-wrap:wrap }

    </style>
  </head>
  <body>
    <div class="grid">
      <div class="box">
        <div class="label">Engine</div>
        <div class="value"><img id="engine-img" src="/images/engine/room.svg" alt="engine" class="value-img"/></div>
      </div>
      <div class="box">
        <div class="label">Time</div>
        <div class="value"><img id="time-img" src="/images/values/0.svg" alt="time" class="value-img"/></div>
      </div>
      <div class="box">
        <div class="label">Delay</div>
        <div class="value"><img id="delay-img" src="/images/values/0.svg" alt="delay" class="value-img"/></div>
      </div>
      <div class="box">
        <div class="label">Control 1</div>
        <div class="value"><img id="control1-img" src="/images/values/0.svg" alt="control1" class="value-img"/></div>
      </div>
      <div class="box">
        <div class="label">Control 2</div>
        <div class="value"><img id="control2-img" src="/images/values/0.svg" alt="control2" class="value-img"/></div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();

      function setText(id, msg){
        const elt = document.getElementById(id);
        if(!elt) return;
        const v = (msg && msg.data && msg.data.value) ? msg.data.value : (typeof msg === 'string' ? msg : JSON.stringify(msg.data || msg));
        elt.textContent = v;
      }

      function getFolderForId(id) {
        const map = { engine: 'engine', time: 'values', delay: 'values', control1: 'values', control2: 'values' };
        return map[id] || id;
      }

      function setImage(id, msg){
        const img = document.getElementById(id + '-img');
        if(!img) return;
        const value = (msg && msg.data && msg.data.value) ? msg.data.value : (typeof msg === 'string' ? msg : JSON.stringify(msg.data || msg));
        const safe = encodeURIComponent(String(value));
        const folder = getFolderForId(id);
        img.src = `/images/${folder}/${safe}.svg`;
        img.onerror = () => { img.onerror = null; img.src = '/images/error.svg'; };
      }

      socket.on('overlay.engine', msg => setImage('engine', msg));
      socket.on('overlay.time', msg => setImage('time', msg));
      socket.on('overlay.delay', msg => setImage('delay', msg));
      socket.on('overlay.control1', msg => setImage('control1', msg));
      socket.on('overlay.control2', msg => setImage('control2', msg));

      // Generic handler for ui.overlay.* subjects forwarded as overlay.<tail>
      socket.onAny((event, msg) => {
        // event like 'overlay.engine' -> keep default handlers above for known IDs
        console.debug('socket event', event, msg);
      });
    </script>
  </body>
</html>
