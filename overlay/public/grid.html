<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Overlay Grid (demo)</title>
    <style>
      :root{ --gap:18px; --muted:#aaa; --box-bg: rgba(0,0,0,0.55); }
      html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif;color:#fff;background:transparent}
      .layout{display:grid;grid-template-columns:repeat(20,1fr);grid-template-rows:15% 85%;height:100vh;width:100vw;position:relative;overflow:hidden}
      .bg{position:absolute;inset:0;background-image:url('/images/background.svg');background-size:cover;background-position:center;filter:brightness(0.45);z-index:0;pointer-events:none}
      /* ensure all content children render above the absolute background */
      .layout > :not(.bg) { position: relative; z-index: 1; }

      .engine-block{grid-column:1 / 9; grid-row:1 / 2; min-width:0; display:flex;flex-direction:column;gap:8px;background:var(--box-bg);padding:12px;border-radius:8px}
      .player-block{grid-column:9 / 17; grid-row:1 / 2; width:100%;background:var(--box-bg);padding:12px;border-radius:8px;text-align:center}
      .chat-area{grid-column:17 / 21; grid-row:1 / 3; position:relative; z-index:1}

      .controls{grid-column:1 / 6; grid-row:2 / 3; display:flex;flex-direction:column;gap:8px}
      .middle-area{grid-column:6 / 17; grid-row:2 / 3}

      .small{width:100%;max-width:220px;padding:8px;background:rgba(0,0,0,0.45);border-radius:6px;display:flex;flex-direction:column;gap:6px}
      .label{color:var(--muted);font-size:12px}
      .value{font-size:18px;font-weight:700;display:flex;align-items:center;justify-content:center;min-height:44px}
      .value-img{max-height:56px;max-width:100%;object-fit:contain;display:block}

      @media(max-width:900px){
        .layout{grid-template-columns:1fr 0;grid-template-rows:auto 1fr}
        .engine-block{grid-column:1 / 2}
        .player-block{grid-column:1 / 2}
        .controls{grid-column:1 / 2}
        .middle-area{grid-column:1 / 2}
        .player-block{width:120px}
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <div class="bg" aria-hidden="true"></div>
          <div class="engine-block">
            <div class="label">Engine</div>
            <div class="value"><img id="engine-img" src="/images/engine/room.svg" class="value-img"/></div>
          </div>

          <div class="player-block">
            <div class="label">Player</div>
            <div id="player" class="value">MCH</div>
          </div>

          <div class="controls">
            <div class="small"><div class="label">Time</div><div class="value"><img id="time-img" src="/images/values/0.svg" class="value-img"/></div></div>
            <div class="small"><div class="label">Delay</div><div class="value"><img id="delay-img" src="/images/values/0.svg" class="value-img"/></div></div>
            <div class="small"><div class="label">Control 1</div><div class="value"><img id="control1-img" src="/images/values/0.svg" class="value-img"/></div></div>
            <div class="small"><div class="label">Control 2</div><div class="value"><img id="control2-img" src="/images/values/0.svg" class="value-img"/></div></div>
          </div>

          <div class="middle-area"><!-- empty center area for stream video (OBS will place the actual video) --></div>

          <div class="chat-area" aria-hidden="true"><!-- reserved for chat (20% width) --></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      function setText(id, msg){
        const elt = document.getElementById(id);
        if(!elt) return;
        const v = (msg && msg.data && msg.data.value) ? msg.data.value : (typeof msg === 'string' ? msg : JSON.stringify(msg.data || msg));
        elt.textContent = v;
      }

      function getFolderForId(id) {
        const map = { engine: 'engine', time: 'values', delay: 'values', control1: 'values', control2: 'values' };
        return map[id] || id;
      }

      function setImage(id, msg){
        const img = document.getElementById(id + '-img');
        if(!img) return;
        const value = (msg && msg.data && msg.data.value) ? msg.data.value : (typeof msg === 'string' ? msg : JSON.stringify(msg.data || msg));
        const safe = encodeURIComponent(String(value));
        const folder = getFolderForId(id);
        img.src = `/images/${folder}/${safe}.svg`;
        img.onerror = () => { img.onerror = null; img.src = '/images/error.svg'; };
      }

      socket.on('overlay.engine', msg => setImage('engine', msg));
      socket.on('overlay.time', msg => setImage('time', msg));
      socket.on('overlay.delay', msg => setImage('delay', msg));
      socket.on('overlay.control1', msg => setImage('control1', msg));
      socket.on('overlay.control2', msg => setImage('control2', msg));
      socket.on('overlay.player', msg => setText('player', msg));

      // Generic handler for ui.overlay.* subjects forwarded as overlay.<tail>
      socket.onAny((event, msg) => {
        console.debug('socket event', event, msg);
      });
    </script>
  </body>
</html>