<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Overlay Grid (demo)</title>
    <style>
      body { background: transparent; color: white; font-family: sans-serif; padding:24px }
      .grid { display: grid; grid-template-columns: repeat(3, 220px); gap: 12px }
      .box { padding: 10px 14px; background: rgba(0,0,0,0.6); border-radius: 6px; min-width:180px }
      .label { color: #aaa; font-size: 12px }
      .value { font-size: 24px; font-weight: 700 }
    </style>
  </head>
  <body>
    <h3>Overlay test grid (use `ui.overlay.*` subjects)</h3>
    <div class="grid">
      <div class="box"><div class="label">Engine</div><div class="value"><img id="engine-img" src="/images/engine/room.svg" class="value-img"/></div></div>
      <div class="box"><div class="label">Time</div><div class="value"><img id="time-img" src="/images/values/0.svg" class="value-img"/></div></div>
      <div class="box"><div class="label">Delay</div><div class="value"><img id="delay-img" src="/images/values/0.svg" class="value-img"/></div></div>
      <div class="box"><div class="label">Control 1</div><div class="value"><img id="control1-img" src="/images/values/0.svg" class="value-img"/></div></div>
      <div class="box"><div class="label">Control 2</div><div class="value"><img id="control2-img" src="/images/values/0.svg" class="value-img"/></div></div>
      <div class="box"><div class="label">Raw</div><div id="raw" class="value">â€”</div></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      function setText(id, msg){
        const elt = document.getElementById(id);
        if(!elt) return;
        const v = (msg && msg.data && msg.data.value) ? msg.data.value : (typeof msg === 'string' ? msg : JSON.stringify(msg.data || msg));
        elt.textContent = v;
      }

      function getFolderForId(id) {
        const map = { engine: 'engine', time: 'values', delay: 'values', control1: 'values', control2: 'values' };
        return map[id] || id;
      }

      function setImage(id, msg){
        const img = document.getElementById(id + '-img');
        if(!img) return;
        const value = (msg && msg.data && msg.data.value) ? msg.data.value : (typeof msg === 'string' ? msg : JSON.stringify(msg.data || msg));
        // expected image path: /images/<folder>/<value>.(svg|png|jpg)
        const safe = encodeURIComponent(String(value));
        const folder = getFolderForId(id);
        img.src = `/images/${folder}/${safe}.svg`;
        img.onerror = () => { img.onerror = null; img.src = '/images/error.svg'; };
      }

      socket.on('overlay.engine', msg => setImage('engine', msg));
      socket.on('overlay.time', msg => setImage('time', msg));
      socket.on('overlay.delay', msg => setImage('delay', msg));
      socket.on('overlay.control1', msg => setImage('control1', msg));
      socket.on('overlay.control2', msg => setImage('control2', msg));
      socket.onAny((evt, msg) => setText('raw', {event:evt, data: msg}));
    </script>
  </body>
</html>
