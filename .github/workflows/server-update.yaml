name: Server Update

on:
  workflow_dispatch:

jobs:
  shutdown:
    name: Shutdown Kubernetes Cluster
    runs-on: self-hosted
    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Display shutdown warning
      run: |
        echo "⚠️  WARNING: Shutting down entire Kubernetes cluster ⚠️"
        echo ""
        echo "This will shutdown:"
        echo "  1. Worker nodes"
        echo "  2. Master node"
        echo "  3. Console/Runner machine"
        echo ""
        echo "The cluster will be completely offline after this operation."
        echo "Physical access will be required to restart the machines."
        echo ""

    - name: Shutdown cluster
      working-directory: ./server
      env:
        SUDO_PASSWORD: ${{ secrets.ANSIBLE_SUDO_PASSWORD }}
      run: make shutdown-cluster
